{"version":3,"file":"toast.js","sources":["../src/dialogWrap.js","../src/toast.js","../src/index.js"],"sourcesContent":["import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\n\nconst IS_REACT_16 = !!ReactDOM.createPortal;\n\nclass DialogWrap extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  componentDidMount() {\n    if (this.props.visible) {\n      this.componentDidUpdate();\n    }\n  }\n\n  componentDidUpdate() {\n    if (!IS_REACT_16 && this.props.visible) {\n      this.renderDialog(this.props.visible);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.props.visible) {\n      if (!IS_REACT_16) {\n        this.renderDialog(false);\n      } else {\n        // TODO for react@16 createPortal animation\n        this.removeContainer();\n      }\n    } else {\n      this.removeContainer();\n    }\n  }\n\n  getContainer() {\n    if (!this.container) {\n      const container = document.createElement('div');\n      const containerId = `pile-container-${(new Date().getTime())}`;\n      container.setAttribute('id', containerId);\n      document.body.appendChild(container);\n      this.container = container;\n    }\n    return this.container;\n  }\n\n  getComponent() {\n    const props = this.props;\n\n    return React.cloneElement(props.children, {\n      onAnimateLeave: this.removeContainer.bind(this), ...props,\n    });\n  }\n\n  removeContainer() {\n    if (this.container) {\n      if (!IS_REACT_16) {\n        ReactDOM.unmountComponentAtNode(this.container);\n      }\n      this.container.parentNode.removeChild(this.container);\n      this.container = null;\n      const { onClose } = this.props;\n      if (onClose) {\n        onClose();\n      }\n    }\n  }\n\n  renderDialog() {\n    ReactDOM.unstable_renderSubtreeIntoContainer(\n      this,\n      this.getComponent(),\n      this.getContainer(),\n    );\n  }\n\n  render() {\n    const { visible } = this.props;\n    if (IS_REACT_16 && visible) {\n      return ReactDOM.createPortal(this.getComponent(), this.getContainer());\n    }\n    return null;\n  }\n}\n\nexport default DialogWrap;\n","import * as React from 'react';\nimport PropTypes from 'prop-types';\nimport Icon from '@pile/icon';\nimport DialogWrap from './dialogWrap';\n\nclass ToastContent extends React.Component {\n  componentDidMount() {\n    this.startCloseTimer();\n  }\n\n  componentDidUpdate(prevProps) {\n    const { duration, content, iconType } = this.props;\n    if (duration !== prevProps.duration\n      || content !== prevProps.content || iconType !== prevProps.iconType) {\n      this.restartCloseTimer();\n    }\n  }\n\n  componentWillUnmount() {\n    this.clearCloseTimer();\n  }\n\n  close() {\n    this.clearCloseTimer();\n    // 执行关闭操作\n    // this.props.onAnimateLeave();\n  }\n\n  startCloseTimer() {\n    const { duration } = this.props;\n    if (duration) {\n      this.closeTimer = setTimeout(() => {\n        this.close();\n      }, duration * 1000);\n    }\n  }\n\n  clearCloseTimer() {\n    if (this.closeTimer) {\n      clearTimeout(this.closeTimer);\n      this.closeTimer = null;\n    }\n  }\n\n  restartCloseTimer() {\n    this.clearCloseTimer();\n    this.startCloseTimer();\n  }\n\n  render() {\n    const { content, iconType } = this.props;\n    return (\n      <div className=\"pile-toast\">\n        {iconType ? (<Icon type=\"check-circle\" size=\"large\" />) : null }\n        <div className=\"pile-toast-content\">\n          {content}\n        </div>\n      </div>\n    );\n  }\n}\n\nconst Toast = props => (\n  <DialogWrap {...props}>\n    <ToastContent />\n  </DialogWrap>\n);\n\nToast.propTypes = {\n  content: PropTypes.string,\n  iconType: PropTypes.oneOf(['success', 'fail', 'load', '']),\n  duration: PropTypes.number,\n  visible: PropTypes.bool,\n  onClose: PropTypes.func,\n};\n\nToast.defaultProps = {\n  content: '',\n  iconType: '',\n  duration: 3,\n  visible: false,\n  onClose: null,\n};\n\nexport default Toast;\n","// export { default as Mask } from './mask';\nexport { default as Toast } from './toast';\n"],"names":["IS_REACT_16","ReactDOM","createPortal","DialogWrap","props","visible","componentDidUpdate","renderDialog","removeContainer","container","document","createElement","containerId","Date","getTime","setAttribute","body","appendChild","React","children","onAnimateLeave","bind","unmountComponentAtNode","parentNode","removeChild","onClose","unstable_renderSubtreeIntoContainer","getComponent","getContainer","ToastContent","startCloseTimer","prevProps","duration","content","iconType","restartCloseTimer","clearCloseTimer","closeTimer","setTimeout","close","clearTimeout","React.createElement","Toast","propTypes","PropTypes","string","oneOf","number","bool","func","defaultProps"],"mappings":"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"}